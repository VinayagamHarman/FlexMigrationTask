/**
 * Generated by Apache Royale Compiler from org/apache/royale/textLayout/operations/ApplyFormatOperation.as
 * org.apache.royale.textLayout.operations.ApplyFormatOperation
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('org.apache.royale.textLayout.operations.ApplyFormatOperation');
/* Royale Dependency List: org.apache.royale.textLayout.edit.ElementRange,org.apache.royale.textLayout.edit.ParaEdit,org.apache.royale.textLayout.edit.PointFormat,org.apache.royale.textLayout.edit.SelectionState,org.apache.royale.textLayout.elements.IParagraphElement,org.apache.royale.textLayout.formats.ITextLayoutFormat,org.apache.royale.textLayout.formats.TextLayoutFormat,XML*/

goog.require('org.apache.royale.textLayout.operations.FlowTextOperation');



/** 
 * Creates an ApplyFormatOperation object.
 *
 *  @asparam operationState	Defines the text range to which the format is applied.
 *  @asparam leafFormat	 The format to apply to LeafFlowElement objects in the selected range.
 *  @asparam paragraphFormat The format to apply to ParagraphElement objects in the selected range.
 *  @asparam containerFormat The format to apply to containers in the selected range.
 * 
 * @playerversion Flash 10
 * @playerversion AIR 1.5
 * @langversion 3.0 
 * @constructor
 * @extends {org.apache.royale.textLayout.operations.FlowTextOperation}
 * @param {org.apache.royale.textLayout.edit.SelectionState} operationState
 * @param {org.apache.royale.textLayout.formats.ITextLayoutFormat} leafFormat
 * @param {org.apache.royale.textLayout.formats.ITextLayoutFormat} paragraphFormat
 * @param {org.apache.royale.textLayout.formats.ITextLayoutFormat=} containerFormat
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation = function(operationState, leafFormat, paragraphFormat, containerFormat) {
  containerFormat = typeof containerFormat !== 'undefined' ? containerFormat : null;
  org.apache.royale.textLayout.operations.ApplyFormatOperation.base(this, 'constructor', operationState);
  this.leafFormat = leafFormat;
  this.paragraphFormat = paragraphFormat;
  this.containerFormat = containerFormat;
};
goog.inherits(org.apache.royale.textLayout.operations.ApplyFormatOperation, org.apache.royale.textLayout.operations.FlowTextOperation);


/**
 * Prevent renaming of class. Needed for reflection.
 */
goog.exportSymbol('org.apache.royale.textLayout.operations.ApplyFormatOperation', org.apache.royale.textLayout.operations.ApplyFormatOperation);


/**
 * @private
 * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat;


/**
 * @private
 * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyParagraphFormat;


/**
 * @private
 * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyContainerFormat;


/**
 * @private
 * @type {Array}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoLeafArray;


/**
 * @private
 * @type {Array}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoParagraphArray;


/**
 * @private
 * @type {Array}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoContainerArray;


/**
 * @private
 * @return {org.apache.royale.textLayout.edit.SelectionState}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.org_apache_royale_textLayout_operations_ApplyFormatOperation_doInternal = function() {
  var /** @type {org.apache.royale.textLayout.edit.SelectionState} */ anyNewSelectionState;
  if (this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat) {
    var /** @type {number} */ begSel = this.absoluteStart;
    var /** @type {number} */ endSel = this.absoluteEnd;
    if (this.absoluteStart == this.absoluteEnd) {
      var /** @type {org.apache.royale.textLayout.elements.IParagraphElement} */ paragraph = this.textFlow.findLeaf(this.absoluteStart).getParagraph();
      if (paragraph.textLength <= 1) {
        endSel++;
        anyNewSelectionState = this.originalSelectionState.clone();
        anyNewSelectionState.pointFormat = null;
      } else if (this.originalSelectionState.selectionManagerOperationState && this.textFlow.interactionManager) {
        anyNewSelectionState = this.originalSelectionState.clone();
        var /** @type {org.apache.royale.textLayout.edit.PointFormat} */ newFormat = new org.apache.royale.textLayout.edit.PointFormat(anyNewSelectionState.pointFormat);
        newFormat.apply(this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat);
        anyNewSelectionState.pointFormat = newFormat;
      }
    }
    if (begSel != endSel) {
      var /** @type {org.apache.royale.textLayout.edit.ElementRange} */ range = org.apache.royale.textLayout.edit.ElementRange.createElementRange(this.textFlow, begSel, endSel);
      begSel = range.absoluteStart;
      endSel = range.absoluteEnd;
      if (endSel == this.textFlow.textLength - 1)
        ++endSel;
      if (!this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoLeafArray) {
        this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoLeafArray = new Array();
        org.apache.royale.textLayout.edit.ParaEdit.cacheStyleInformation(this.textFlow, begSel, endSel, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoLeafArray);
      }
      org.apache.royale.textLayout.edit.ParaEdit.applyTextStyleChange(this.textFlow, begSel, endSel, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat, null);
    }
  }
  if (this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyParagraphFormat) {
    if (!this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoParagraphArray) {
      this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoParagraphArray = new Array();
      org.apache.royale.textLayout.edit.ParaEdit.cacheParagraphStyleInformation(this.textFlow, this.absoluteStart, this.absoluteEnd, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoParagraphArray);
    }
    org.apache.royale.textLayout.edit.ParaEdit.applyParagraphStyleChange(this.textFlow, this.absoluteStart, this.absoluteEnd, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyParagraphFormat, null);
  }
  if (this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyContainerFormat) {
    if (!this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoContainerArray) {
      this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoContainerArray = new Array();
      org.apache.royale.textLayout.edit.ParaEdit.cacheContainerStyleInformation(this.textFlow, this.absoluteStart, this.absoluteEnd, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoContainerArray);
    }
    org.apache.royale.textLayout.edit.ParaEdit.applyContainerStyleChange(this.textFlow, this.absoluteStart, this.absoluteEnd, this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyContainerFormat, null);
  }
  return anyNewSelectionState;
};


/** @asprivate 
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.doOperation = function() {
  var /** @type {org.apache.royale.textLayout.edit.SelectionState} */ newSelectionState = this.org_apache_royale_textLayout_operations_ApplyFormatOperation_doInternal();
  if (newSelectionState && this.textFlow.interactionManager)
    this.textFlow.interactionManager.setSelectionState(newSelectionState);
  return true;
};


/** @asprivate 
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.redo = function() {
  var /** @type {org.apache.royale.textLayout.edit.SelectionState} */ newSelectionState = this.org_apache_royale_textLayout_operations_ApplyFormatOperation_doInternal();
  return newSelectionState ? newSelectionState : this.originalSelectionState;
};


/** @asprivate 
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.undo = function() {
  var /** @type {Object} */ obj;
  var foreachiter0_target = this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoLeafArray;
  for (var foreachiter0 in foreachiter0_target) 
  {
  obj = foreachiter0_target[foreachiter0];
  
    org.apache.royale.textLayout.edit.ParaEdit.setTextStyleChange(this.textFlow, (obj.begIdx) >> 0, (obj.endIdx) >> 0, obj.style);}
  
  var foreachiter1_target = this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoParagraphArray;
  for (var foreachiter1 in foreachiter1_target) 
  {
  obj = foreachiter1_target[foreachiter1];
  
    org.apache.royale.textLayout.edit.ParaEdit.setParagraphStyleChange(this.textFlow, (obj.begIdx) >> 0, (obj.endIdx) >> 0, obj.attributes);}
  
  var foreachiter2_target = this.org_apache_royale_textLayout_operations_ApplyFormatOperation_undoContainerArray;
  for (var foreachiter2 in foreachiter2_target) 
  {
  obj = foreachiter2_target[foreachiter2];
  
    org.apache.royale.textLayout.edit.ParaEdit.setContainerStyleChange(obj);}
  
  return this.originalSelectionState;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__leafFormat = function() {
  return this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__leafFormat = function(value) {
  this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyLeafFormat = value ? new org.apache.royale.textLayout.formats.TextLayoutFormat(value) : null;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__paragraphFormat = function() {
  return this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyParagraphFormat;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__paragraphFormat = function(value) {
  this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyParagraphFormat = value ? new org.apache.royale.textLayout.formats.TextLayoutFormat(value) : null;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__containerFormat = function() {
  return this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyContainerFormat;
};


org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__containerFormat = function(value) {
  this.org_apache_royale_textLayout_operations_ApplyFormatOperation_applyContainerFormat = value ? new org.apache.royale.textLayout.formats.TextLayoutFormat(value) : null;
};


Object.defineProperties(org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype, /** @lends {org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype} */ {
/**
  * @export
  * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat} */
leafFormat: {
get: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__leafFormat,
set: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__leafFormat},
/**
  * @export
  * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat} */
paragraphFormat: {
get: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__paragraphFormat,
set: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__paragraphFormat},
/**
  * @export
  * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat} */
containerFormat: {
get: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.get__containerFormat,
set: org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.set__containerFormat}}
);


/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'ApplyFormatOperation', qName: 'org.apache.royale.textLayout.operations.ApplyFormatOperation', kind: 'class' }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    accessors: function () {
      return {
        'leafFormat': { type: 'org.apache.royale.textLayout.formats.ITextLayoutFormat', access: 'readwrite', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'},
        'paragraphFormat': { type: 'org.apache.royale.textLayout.formats.ITextLayoutFormat', access: 'readwrite', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'},
        'containerFormat': { type: 'org.apache.royale.textLayout.formats.ITextLayoutFormat', access: 'readwrite', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'}
      };
    },
    methods: function () {
      return {
        'ApplyFormatOperation': { type: '', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation', parameters: function () { return [ 'org.apache.royale.textLayout.edit.SelectionState', false ,'org.apache.royale.textLayout.formats.ITextLayoutFormat', false ,'org.apache.royale.textLayout.formats.ITextLayoutFormat', false ,'org.apache.royale.textLayout.formats.ITextLayoutFormat', true ]; }},
        'doOperation': { type: 'Boolean', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'},
        'redo': { type: 'org.apache.royale.textLayout.edit.SelectionState', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'},
        'undo': { type: 'org.apache.royale.textLayout.edit.SelectionState', declaredBy: 'org.apache.royale.textLayout.operations.ApplyFormatOperation'}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
org.apache.royale.textLayout.operations.ApplyFormatOperation.prototype.ROYALE_COMPILE_FLAGS = 10;
