/**
 * Generated by Apache Royale Compiler from org/apache/royale/textLayout/operations/CreateDivOperation.as
 * org.apache.royale.textLayout.operations.CreateDivOperation
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('org.apache.royale.textLayout.operations.CreateDivOperation');
/* Royale Dependency List: org.apache.royale.textLayout.edit.ElementMark,org.apache.royale.textLayout.edit.MementoList,org.apache.royale.textLayout.edit.ModelEdit,org.apache.royale.textLayout.edit.SelectionState,org.apache.royale.textLayout.elements.DivElement,org.apache.royale.textLayout.elements.ElementHelper,org.apache.royale.textLayout.elements.IDivElement,org.apache.royale.textLayout.elements.IFlowGroupElement,org.apache.royale.textLayout.elements.IListItemElement,org.apache.royale.textLayout.elements.IParagraphElement,org.apache.royale.textLayout.elements.ISubParagraphGroupElementBase,org.apache.royale.textLayout.formats.ITextLayoutFormat,org.apache.royale.utils.Language,XML*/

goog.require('org.apache.royale.textLayout.operations.FlowTextOperation');



/** 
 * Creates an CreateDivOperation object.
 * 
 * @playerversion Flash 10
 * @playerversion AIR 1.5
 * @langversion 3.0 
 * @constructor
 * @extends {org.apache.royale.textLayout.operations.FlowTextOperation}
 * @param {org.apache.royale.textLayout.edit.SelectionState} operationState
 * @param {org.apache.royale.textLayout.elements.IFlowGroupElement=} parent
 * @param {org.apache.royale.textLayout.formats.ITextLayoutFormat=} format
 */
org.apache.royale.textLayout.operations.CreateDivOperation = function(operationState, parent, format) {
  parent = typeof parent !== 'undefined' ? parent : null;
  format = typeof format !== 'undefined' ? format : null;
  org.apache.royale.textLayout.operations.CreateDivOperation.base(this, 'constructor', operationState);
  this.parent = parent;
  this.org_apache_royale_textLayout_operations_CreateDivOperation__format = format;
  this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList = new org.apache.royale.textLayout.edit.MementoList(operationState.textFlow);
};
goog.inherits(org.apache.royale.textLayout.operations.CreateDivOperation, org.apache.royale.textLayout.operations.FlowTextOperation);


/**
 * Prevent renaming of class. Needed for reflection.
 */
goog.exportSymbol('org.apache.royale.textLayout.operations.CreateDivOperation', org.apache.royale.textLayout.operations.CreateDivOperation);


/**
 * @private
 * @type {org.apache.royale.textLayout.edit.ElementMark}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.org_apache_royale_textLayout_operations_CreateDivOperation__divParentMarker;


/**
 * @private
 * @type {org.apache.royale.textLayout.edit.MementoList}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList;


/**
 * @private
 * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.org_apache_royale_textLayout_operations_CreateDivOperation__format;


/**
 * @private
 * @type {org.apache.royale.textLayout.elements.IDivElement}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.org_apache_royale_textLayout_operations_CreateDivOperation__divElement;


/**
 * @private
 * @type {org.apache.royale.textLayout.edit.SelectionState}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.org_apache_royale_textLayout_operations_CreateDivOperation__postOpSelectionState;


/**
 *  @asprivate
 * @royaleignorecoercion org.apache.royale.textLayout.elements.IFlowGroupElement
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.doOperation = function() {
  var /** @type {number} */ endChildIndex = 0;
  var /** @type {Object} */ target = this.parent;
  if (!target || org.apache.royale.utils.Language.is(target, org.apache.royale.textLayout.elements.IParagraphElement) || org.apache.royale.utils.Language.is(target, org.apache.royale.textLayout.elements.ISubParagraphGroupElementBase))
    return false;
  var /** @type {number} */ begChildIndex = 0;
  var /** @type {number} */ begStart = (this.absoluteStart - target.getAbsoluteStart()) >> 0;
  
  //var /** @type {number} */ endChildIndex = 0;
  var /** @type {number} */ endStart = (this.absoluteEnd - target.getAbsoluteStart()) >> 0;
  
  var /** @type {Object} */ child;
  if (begStart > 0) {
    begChildIndex = target.findChildIndexAtPosition(begStart);
    child = target.getChildAt(begChildIndex);
    if (child.parentRelativeStart != begStart) {
      this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.splitElement(this.textFlow, child, (begStart - child.parentRelativeStart) >> 0));
      if (org.apache.royale.utils.Language.is(child, org.apache.royale.textLayout.elements.IParagraphElement))
        endStart++;
      begChildIndex++;
    }
  }
  if (endStart >= 0) {
    if (endStart >= target.textLength - 1)
      endChildIndex = target.numChildren; else {
      endChildIndex = target.findChildIndexAtPosition(endStart);
      child = target.getChildAt(endChildIndex);
      if (child.parentRelativeStart != endStart) {
        this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.splitElement(this.textFlow, child, (endStart - child.parentRelativeStart) >> 0));
        endChildIndex++;
      }
    }
  }
  else
    endChildIndex = (begChildIndex + 1) >> 0;
  this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement = new org.apache.royale.textLayout.elements.DivElement();
  this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.format = this.format;
  if (begChildIndex == target.numChildren) {
    child = target.getChildAt((target.numChildren - 1) >> 0);
    this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.splitElement(this.textFlow, child, child.textLength));
    this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.addElement(this.textFlow, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, target, target.numChildren));
    this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.moveElement(this.textFlow, child, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.numChildren));
  } else {
    this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.addElement(this.textFlow, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, target, endChildIndex));
    if (begChildIndex == endChildIndex) {
      this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.addElement(this.textFlow, org.apache.royale.textLayout.elements.ElementHelper.getParagraph(), this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, 0));
    } else {
      while (begChildIndex < endChildIndex) {
        child = target.getChildAt(begChildIndex);
        if (org.apache.royale.utils.Language.is(child, org.apache.royale.textLayout.elements.IListItemElement)) {
          while (child.numChildren)
            this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.moveElement(this.textFlow, child.getChildAt(0), this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.numChildren));
          this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.removeElements(this.textFlow, target, begChildIndex, 1));
        } else {
          this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.moveElement(this.textFlow, child, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.numChildren));
          child.normalizeRange(0, (child.textLength) >>> 0);
        }
        endChildIndex--;
      }
    }
    if (org.apache.royale.utils.Language.is(target, org.apache.royale.textLayout.elements.IListItemElement) && target.normalizeNeedsInitialParagraph())
      this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.push(org.apache.royale.textLayout.edit.ModelEdit.addElement(this.textFlow, org.apache.royale.textLayout.elements.ElementHelper.getParagraph(), target, 0));
  }
  if (this.originalSelectionState.selectionManagerOperationState && this.textFlow.interactionManager) {
    this.textFlow.normalize();
    this.org_apache_royale_textLayout_operations_CreateDivOperation__postOpSelectionState = new org.apache.royale.textLayout.edit.SelectionState(this.textFlow, this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.getAbsoluteStart(), this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.getAbsoluteStart() + this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement.textLength - 1);
    this.textFlow.interactionManager.setSelectionState(this.org_apache_royale_textLayout_operations_CreateDivOperation__postOpSelectionState);
  }
  return true;
};


/** @asprivate 
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.undo = function() {
  this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.undo();
  return this.originalSelectionState;
};


/** @asprivate 
 * @export
 * @override
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.redo = function() {
  this.org_apache_royale_textLayout_operations_CreateDivOperation__mementoList.redo();
  return this.org_apache_royale_textLayout_operations_CreateDivOperation__postOpSelectionState;
};


org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__parent = function() {
  return this.org_apache_royale_textLayout_operations_CreateDivOperation__divParentMarker ? this.org_apache_royale_textLayout_operations_CreateDivOperation__divParentMarker.findElement(this.originalSelectionState.textFlow) : null;
};


org.apache.royale.textLayout.operations.CreateDivOperation.prototype.set__parent = function(value) {
  if (!value) {
    value = this.textFlow;
    var /** @type {number} */ begPos = this.absoluteStart;
    var /** @type {number} */ endPos = this.absoluteEnd;
    for (;;) {
      var /** @type {number} */ begChildIdx = value.findChildIndexAtPosition(begPos);
      var /** @type {org.apache.royale.textLayout.elements.IFlowGroupElement} */ elem = value.getChildAt(begChildIdx);
      if (org.apache.royale.utils.Language.is(elem, org.apache.royale.textLayout.elements.IParagraphElement))
        break;
      begPos -= elem.parentRelativeStart;
      endPos -= elem.parentRelativeStart;
      if (endPos >= elem.textLength)
        break;
      value = elem;
    }
  }
  else if (org.apache.royale.utils.Language.is(value, org.apache.royale.textLayout.elements.ISubParagraphGroupElementBase))
    value = value.getParagraph().parent;
  this.org_apache_royale_textLayout_operations_CreateDivOperation__divParentMarker = new org.apache.royale.textLayout.edit.ElementMark(value, 0);
};


org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__format = function() {
  return this.org_apache_royale_textLayout_operations_CreateDivOperation__format;
};


org.apache.royale.textLayout.operations.CreateDivOperation.prototype.set__format = function(value) {
  this.org_apache_royale_textLayout_operations_CreateDivOperation__format = value;
};


org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__newDivElement = function() {
  return this.org_apache_royale_textLayout_operations_CreateDivOperation__divElement;
};


Object.defineProperties(org.apache.royale.textLayout.operations.CreateDivOperation.prototype, /** @lends {org.apache.royale.textLayout.operations.CreateDivOperation.prototype} */ {
/**
  * @export
  * @type {org.apache.royale.textLayout.elements.IFlowGroupElement} */
parent: {
get: org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__parent,
set: org.apache.royale.textLayout.operations.CreateDivOperation.prototype.set__parent},
/**
  * @export
  * @type {org.apache.royale.textLayout.formats.ITextLayoutFormat} */
format: {
get: org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__format,
set: org.apache.royale.textLayout.operations.CreateDivOperation.prototype.set__format},
/**
  * @export
  * @type {org.apache.royale.textLayout.elements.IDivElement} */
newDivElement: {
get: org.apache.royale.textLayout.operations.CreateDivOperation.prototype.get__newDivElement}}
);


/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'CreateDivOperation', qName: 'org.apache.royale.textLayout.operations.CreateDivOperation', kind: 'class' }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    accessors: function () {
      return {
        'parent': { type: 'org.apache.royale.textLayout.elements.IFlowGroupElement', access: 'readwrite', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'},
        'format': { type: 'org.apache.royale.textLayout.formats.ITextLayoutFormat', access: 'readwrite', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'},
        'newDivElement': { type: 'org.apache.royale.textLayout.elements.IDivElement', access: 'readonly', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'}
      };
    },
    methods: function () {
      return {
        'CreateDivOperation': { type: '', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation', parameters: function () { return [ 'org.apache.royale.textLayout.edit.SelectionState', false ,'org.apache.royale.textLayout.elements.IFlowGroupElement', true ,'org.apache.royale.textLayout.formats.ITextLayoutFormat', true ]; }},
        'doOperation': { type: 'Boolean', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'},
        'undo': { type: 'org.apache.royale.textLayout.edit.SelectionState', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'},
        'redo': { type: 'org.apache.royale.textLayout.edit.SelectionState', declaredBy: 'org.apache.royale.textLayout.operations.CreateDivOperation'}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
org.apache.royale.textLayout.operations.CreateDivOperation.prototype.ROYALE_COMPILE_FLAGS = 10;
